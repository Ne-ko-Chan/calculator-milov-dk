# calculator-milov-dk

## Описание проделаанной работы

### Результаты

В ходе работы был создан калькулятор, отвечающий следующим критериям:
- получение данных из ```stdin```
- вывод ответа в ```stdout```
- корректная работа для входных данных объёмом менее 1KiB
- работа с выражениями в алфавите ```[0-9()*+/-]```(также разрешены пробельные символы: ```\n,\f,\t,\v,\r```)
- обработка ошибок ввода выражения(возвращение ненулевого кода ошибки)
- поддержка ввода, состоящего из целых чисел в промежутке от 0 до 
$2\times10^9$
- корректно работает для всех выражений, в которых каждый результат промежуточных вычислений(в любом из доступных порядков вычисления) находится в пределах $[-2\times10^9\dots+2\times10^9]$ (иначе ```UB```)
- поддержка флага ```--float``` для переключения калькулютора в режим вычислений с плавающей точкой
- в целочисленном режиме деление целочисленное
- в режиме с плавающей точкой деление дробное и точность ответа составляет $10^{-4}$
- в случае, если в любой момент в ходе подсчётов происходит деление на число, меньшее $10^{-4}$, корректная работа не гарантируется(```UB```)

### Запуск

Программу можно запустить в целочисленном режиме:
```bash
make run-int
```
И в режиме вычислений с плавающей точкой:
```bash
make run-float
```
В обоих режимах программа ожидает на вход выражение, которое необходимо вычислить(о его синтаксисе в пункте выше). Результат же печатается в ```stdout```.

Также для программы написаны unit тесты и интеграционные тесты. Их запуск:
```bash
make run-unit-tests
make run-integration-tests
```

### Как устроен калькулятор

Калькулятор написан на языке программирования ```C```, в его основе лежит алгоритм сортировочной станции, позволяющий преобразовать входной поток символов в выражение в обратной польской записи. После преобразования в ОПЗ, алгоритм тривиально вычисляет его при помощи стека.

### История изменений

#### KEY-1
Тестовая задача для проверки отображения репозитория в Yandex Tracker

#### KEY-2

Была создана обёртка вокруг калькулятора, позволяющая обращаться к программе на С из программы на Python. Добавлена базовая проверка кода возврата калькулятора для отслеживания ошибок. Более детальная обработка ошибок будет сделана на других этапах.

#### KEY-3

Добавлена базовая обработка POST-запросов, согласно модели OpenAPI. Реализован парсинг данных входящего запрос, а также отправка данных запроса на вход калькулятору. Обработка ошибки 404.

#### KEY-4

Сделана обработка ошибок, связанных с неккоректынм вводом пользователя и ошибками в работе программы на С. Добавлена отправка пользователю сообщений об ошибочных ситуациях. С правильными кодами состояний. Калькулятор на С может остановиться со следующими кодами возврата ошибочных ситуаций.

|Ситуация| Код ошибки|
|---|---|
|Некорректный символ на входе|-1|
|Нарушен порядок скобок|-2|
|Неккоректное выражение: Опустошение стека |-3|
|Пустой ввод|-4|
|Деление на ноль|-5|
|Число операндов не соответствует числу операций|-6|
|Ошибочный порядок внутри выражения|-7|

#### KEY-5

Добавлен форматированный вывод сообщений о состоянии в консоль при помощи Structlog. Логи отправляютяс в случае любой ошибочной ситуации, а также во время ключевых моментов исполнения программы (Запуск сервера, входящий запрос, успешная обработка запроса и т.д)

#### KEY-6

Ведение логов в формате JSON. Благодаря функциям Structlog, логи в формате JSON отправляются в те же самые моменты, что и в консоль.

#### KEY-7

Добавлено описание ключевых моментов разработки.


